<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Cart - Alpha Clothing</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body style="background-color: #f1f3f6;">
    <header class="site-header">
        <div class="container">
            <div class="header-main">
                <a class="brand" href="index.html"><img src="form1.png" alt="Alpha" class="logo-img"></a>
                <div class="search-bar-container">
                    <input type="text" placeholder="Search for products, brands and more">
                    <button><i class="fas fa-search"></i></button>
                </div>
               <nav class="nav-actions">
    <a href="index.html" class="desktop-link">Home</a>
    
    <button class="login-btn" id="signin-btn">Login</button>
    
    <div class="user-dropdown" id="user-profile" style="display: none;">
        <span class="user-trigger">
            <i class="fas fa-user-circle"></i> 
            <span id="user-name">User</span> 
            <i class="fas fa-chevron-down" style="font-size: 10px; margin-left: 3px;"></i>
        </span>
        <div class="dropdown-menu">
            <a href="orders.html"><i class="fas fa-box"></i> My Orders</a>
            <hr>
            <a href="#" onclick="logout()" style="color: red;"><i class="fas fa-sign-out-alt"></i> Logout</a>
        </div>
    </div>

    <a href="cart.html" class="cart-link">
        <div style="position: relative;">
            <i class="fas fa-shopping-cart"></i>
            <span id="cart-count" class="cart-badge">0</span>
        </div>
        <span>Cart</span>
    </a>
</nav>
            </div>
        </div>
    </header>

    <main class="container" style="margin-top: 20px;">
        <div class="cart-layout" id="cart-container">

            <div class="cart-items" id="cart-items-list"
                style="background: white; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                <div style="padding: 20px; text-align: center;">Loading Cart...</div>
            </div>

            <div class="cart-sidebar">
                <div class="price-box" style="border-radius: 4px; border: none; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                    <h3
                        style="color: #878787; font-size: 16px; border-bottom: 1px solid #f0f0f0; padding-bottom: 15px; margin-top: 0;">
                        PRICE DETAILS</h3>

                    <div class="price-row">
                        <span>Price (<span id="total-items">0</span> items)</span>
                        <span id="total-mrp">₹0</span>
                    </div>

                    <div class="price-row">
                        <span>Discount</span>
                        <span style="color: #388e3c;">- ₹0</span>
                    </div>

                    <div class="price-row">
                        <span>Delivery Charges</span>
                        <span style="color: #388e3c;">Free</span>
                    </div>

                    <div class="price-row total"
                        style="border-top: 1px dashed #e0e0e0; margin-top: 20px; padding-top: 20px; font-size: 18px;">
                        <span>Total Amount</span>
                        <span id="final-total">₹0</span>
                    </div>

                    <p style="color: #388e3c; font-weight: 600; font-size: 14px; margin-top: 15px;">You will save ₹0 on
                        this order</p>

                    <button class="btn"
                        style="width: 100%; margin-top: 20px; background: #fb641b; border: none; font-size: 16px; padding: 14px; border-radius: 2px; box-shadow: 0 2px 4px rgba(0,0,0,0.2);"
                        onclick="window.location.href='checkout.html'">PLACE ORDER</button>
                </div>
            </div>
        </div>
    </main>
<div id="signin-modal" class="modal" aria-hidden="true">
        <div class="modal-dialog signin-dialog">
            <button class="modal-close" id="signin-close">&times;</button>
            <h2>Sign In</h2>
            <form id="signin-form">
                <label>Email</label>
                <input type="email" id="signin-email" required placeholder="Enter your email">
                <label>Password</label>
                <input type="password" id="signin-password" required placeholder="Enter your password">
                <button type="submit" class="btn" style="width: 100%;">Login</button>
                <p style="margin-top: 10px; text-align: center;">
                    Don’t have an account? <a href="#" id="signup-link">Register</a>
                </p>
            </form>
        </div>
    </div>

    <div id="signup-modal" class="modal" aria-hidden="true">
        <div class="modal-dialog signin-dialog">
            <button class="modal-close" id="signup-close">&times;</button>
            <h2>Create Account</h2>
            <form id="signup-form">
                <label>Full Name</label>
                <input type="text" id="signup-name" required placeholder="Enter your name">
                <label>Email</label>
                <input type="email" id="signup-email" required placeholder="Enter your email">
                <label>Password</label>
                <input type="password" id="signup-password" required placeholder="Create a password">
                <button type="submit" class="btn" style="width: 100%;">Register Now</button>
                <p style="margin-top: 15px; text-align: center;">
                    Already have an account? <a href="#" id="go-to-signin">Sign In</a>
                </p>
            </form>
        </div>
    </div>
    <div id="toast-box"></div>
    <script src="data.js"></script>
   <!-- <script type="module" src="auth-logic.js"></script> -->
<script type="module" src="script.js"></script>
   <script type="module">
        import { auth, db, doc, getDoc, updateDoc } from "./firebase-config.js";
        import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const cartList = document.getElementById('cart-items-list');
        const cartContainer = document.getElementById('cart-container');
        const totalItemsEl = document.getElementById('total-items');
        const totalMrpEl = document.getElementById('total-mrp');
        const finalTotalEl = document.getElementById('final-total');

        // --- 1. CHECK LOGIN & FETCH CART ---
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                // User Login Hai -> Database se Cart nikalo
                const userDoc = await getDoc(doc(db, "users", user.uid));
                
                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    const cart = userData.cart || []; // Agar cart nahi hai to empty array
                    renderCart(cart);
                    
                    // Remove Function ko Global bana rahe hain taaki HTML onclick use kar sake
                    window.removeItem = async (index) => {
                        if(confirm("Are you sure you want to remove this item?")) {
                            cart.splice(index, 1); // Array se hatao
                            
                            // Wapas Database me save karo
                            await updateDoc(doc(db, "users", user.uid), {
                                cart: cart
                            });
                            
                            // UI Update
                            renderCart(cart);
                            alert("Item Removed");
                            location.reload(); // Header count update karne ke liye
                        }
                    };
                }
            } else {
                // Login Nahi Hai
                cartContainer.innerHTML = `<div style="text-align:center; padding:50px;"><h3>Please Login to view Cart</h3><a href="index.html" class="btn">Go Home</a></div>`;
            }
        });

        // --- 2. RENDER CART UI ---
        function renderCart(cart) {
            if (cart.length === 0) {
                cartContainer.innerHTML = `
                    <div style="text-align:center; padding: 50px; background: white; width: 100%;">
                        <img src="https://rukminim1.flixcart.com/www/800/800/promos/16/05/2019/d438a32e-765a-4d8b-b4a6-520b560971e8.png" style="height: 160px; margin-bottom: 20px;">
                        <h3>Your cart is empty!</h3>
                        <p>Add items to it now.</p>
                        <a href="index.html" class="btn" style="margin-top:20px; background: #2874f0; border:none; padding: 10px 30px;">Shop Now</a>
                    </div>`;
                return;
            }

            let html = '';
            let total = 0;

            cart.forEach((item, index) => {
                total += parseInt(item.price);
                html += `
                <div class="cart-item" style="border-bottom: 1px solid #f0f0f0; margin: 0; box-shadow: none; border-radius: 0;">
                    <img src="${item.img}" alt="${item.title}" style="height: 112px; width: 112px; object-fit: contain;">
                    <div class="item-details">
                        <h4 style="font-weight: 400; font-size: 16px;">${item.title}</h4>
                        <p class="text-muted" style="font-size: 14px; margin: 5px 0;">Size: <strong>${item.size || 'M'}</strong></p>
                        <div class="item-price" style="font-size: 18px;">₹ ${item.price} <span style="color: #388e3c; font-size: 13px; margin-left: 10px;">Free Delivery</span></div>
                        <button class="remove-btn" onclick="window.removeItem(${index})" style="font-weight: 600; font-size: 14px; margin-top: 10px; text-transform: uppercase; border:none; background:none; cursor:pointer;">REMOVE</button>
                    </div>
                </div>`;
            });

            cartList.innerHTML = html;
            if(totalItemsEl) totalItemsEl.textContent = cart.length;
            if(totalMrpEl) totalMrpEl.textContent = '₹ ' + total;
            if(finalTotalEl) finalTotalEl.textContent = '₹ ' + total;
        }
    </script>
</body>

</html>